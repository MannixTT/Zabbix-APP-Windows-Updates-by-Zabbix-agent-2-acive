zabbix_export:
  version: '7.0'
  template_groups:
    - uuid: 7df96b18c230490a9a0a9e2307226338
      name: Templates
    - uuid: 846977d1dfed4968bc5f8bdb363285bc
      name: 'Templates/Operating systems'
  templates:
    - uuid: 8ea6a68b71a9493aa78cb5291b7affa3
      template: 'APP-Windows Updates by Zabbix agent active 2'
      name: 'APP-Windows Updates by Zabbix agent active 2'
      groups:
        - name: Templates
        - name: 'Templates/Operating systems'
      items:
        - uuid: c7866d01438a43d88085815e1ccc0b8a
          name: 'Deploy PS Script'
          type: ZABBIX_ACTIVE
          key: 'system.run[powershell.exe -NoProfile -ExecutionPolicy Bypass -command Invoke-WebRequest -Uri https://raw.githubusercontent.com/MannixTT/Zabbix-APP-Windows-Updates-by-Zabbix-agent-2-active/6dd174060225e94b3ea7737ac7eb41e4eaf91a15/check_win_updates-v5.ps1 -OutFile $Env:Programfiles\''Zabbix Agent 2\plugins\check_win_updates-v5.ps1'',nowait]'
          delay: 1d
          history: 90d
          trends: '0'
          status: DISABLED
          value_type: TEXT
          description: 'Deploys the script automatically to the standard path of the agent by downloading it from Github'
          tags:
            - tag: Application
              value: OS-Update
        - uuid: e0fdbbb63cf94159851dc7d74b3474f3
          name: WinUpdate-Check
          type: ZABBIX_ACTIVE
          key: 'system.run[powershell.exe -NoProfile -ExecutionPolicy Bypass -file "%programfiles%\Zabbix Agent 2\plugins\check_win_updates-v5.ps1",nowait]'
          delay: 1d
          history: 30d
          trends: '0'
          value_type: TEXT
          description: 'Executes the Powershell script to revieve the data'
          tags:
            - tag: Application
              value: OS-Update
        - uuid: 0a734c892c644dc99637c5b41ccc7ad9
          name: 'Critical Updates'
          type: TRAP
          key: Winupdates.Critical
          delay: '0'
          history: 30d
          trends: 30d
          description: 'Number of Critical Windows Updates Available'
          tags:
            - tag: Application
              value: OS-Update
          triggers:
            - uuid: c6a26e6a846e482a8ffd6266e737c8ba
              expression: 'last(/APP-Windows Updates by Zabbix agent active 2/Winupdates.Critical)>0 and last(/APP-Windows Updates by Zabbix agent active 2/Winupdates.Critical)<3'
              name: 'There are critical updates for {HOST.NAME}'
              priority: INFO
            - uuid: b5c12b215f8c44dd8cc07d8a41b8ee3a
              expression: 'last(/APP-Windows Updates by Zabbix agent active 2/Winupdates.Critical)>3'
              name: 'There are more than 3 critical updates for {HOST.NAME}'
              priority: WARNING
        - uuid: 549583c196e844809c7fd54b74164c3a
          name: 'Hidden Updates'
          type: TRAP
          key: Winupdates.Hidden
          delay: '0'
          history: 30d
          trends: 30d
          description: 'Number of Hidden Windows Updates'
          tags:
            - tag: Application
              value: OS-Update
          triggers:
            - uuid: 93a6265c9637443c84a46a3aed6d8820
              expression: 'last(/APP-Windows Updates by Zabbix agent active 2/Winupdates.Hidden)>0'
              name: 'There are hidden updates for {HOST.NAME}'
              priority: INFO
              manual_close: 'YES'
        - uuid: a692ec8ff72044cb8ef1c672a59f7aa6
          name: 'Last Updated'
          type: TRAP
          key: Winupdates.LastUpdated
          delay: '0'
          history: 30d
          trends: '0'
          value_type: TEXT
          description: 'Date last Windows updates were applied'
          tags:
            - tag: Application
              value: OS-Update
        - uuid: 0f9c1f440cea4245bc9dc994f74f1bc0
          name: 'Optional Updates'
          type: TRAP
          key: Winupdates.Optional
          delay: '0'
          history: 30d
          trends: 30d
          description: 'Number of Optional Windows Updates Available'
          tags:
            - tag: Application
              value: OS-Update
          triggers:
            - uuid: 9da058b2cb4d465fa7b49180b47e374f
              expression: 'last(/APP-Windows Updates by Zabbix agent active 2/Winupdates.Optional)>5'
              name: 'There are a large number of optional updates for {HOST.NAME}'
              priority: WARNING
            - uuid: cf3b2a03881a416098a09fc884a94b02
              expression: 'last(/APP-Windows Updates by Zabbix agent active 2/Winupdates.Optional)>0'
              name: 'There are optional updates for {HOST.NAME}'
              priority: INFO
        - uuid: 949c23798c6243ff81c6fe59bf2df1e7
          name: 'Reboot Required'
          type: TRAP
          key: Winupdates.Reboot
          delay: '0'
          history: 30d
          trends: '0'
          description: 'Detects whether a reboot is required to apply a update'
          valuemap:
            name: 'Reboot state'
          tags:
            - tag: Application
              value: OS-Update
          triggers:
            - uuid: 3777d1809e9043cfa0002fa292552e00
              expression: 'last(/APP-Windows Updates by Zabbix agent active 2/Winupdates.Reboot)=1'
              name: 'Reboot required for {HOST.NAME}'
              priority: INFO
        - uuid: cc3cb1cb03c04e6b893df2798f247944
          name: 'Installing Updates'
          type: TRAP
          key: Winupdates.Updating
          delay: '0'
          history: 30d
          trends: 30d
          status: DISABLED
          description: 'Windows is installing updates'
          tags:
            - tag: Application
              value: OS-Update
          triggers:
            - uuid: aa32e5c2d5d9403fa2f1b078fdd3b1e5
              expression: 'last(/APP-Windows Updates by Zabbix agent active 2/Winupdates.Updating)=1'
              name: '{HOST.NAME} is running updates'
              priority: INFO
              manual_close: 'YES'
      dashboards:
        - uuid: a4fe1c3f33ff462196ba6425a90a04ea
          name: 'Windows Update'
          pages:
            - widgets:
                - type: honeycomb
                  name: 'Update state'
                  width: '36'
                  height: '6'
                  fields:
                    - type: STRING
                      name: items.0
                      value: 'Critical Updates'
                    - type: STRING
                      name: items.1
                      value: 'Hidden Updates'
                    - type: STRING
                      name: items.2
                      value: 'Optional Updates'
                    - type: STRING
                      name: primary_label
                      value: '{ITEM.NAME}'
                    - type: STRING
                      name: reference
                      value: GYSFO
                    - type: INTEGER
                      name: secondary_label_decimal_places
                      value: '0'
                    - type: STRING
                      name: thresholds.0.color
                      value: 0EC9AC
                    - type: STRING
                      name: thresholds.0.threshold
                      value: '0'
                    - type: STRING
                      name: thresholds.1.color
                      value: FFD54F
                    - type: STRING
                      name: thresholds.1.threshold
                      value: '1'
                    - type: STRING
                      name: thresholds.2.color
                      value: FF465C
                    - type: STRING
                      name: thresholds.2.threshold
                      value: '3'
                - type: item
                  name: 'Reboot required'
                  x: '36'
                  width: '22'
                  height: '3'
                  fields:
                    - type: INTEGER
                      name: decimal_places
                      value: '0'
                    - type: ITEM
                      name: itemid.0
                      value:
                        host: 'APP-Windows Updates by Zabbix agent active 2'
                        key: Winupdates.Reboot
                    - type: INTEGER
                      name: show.0
                      value: '2'
                    - type: INTEGER
                      name: show.1
                      value: '4'
                    - type: STRING
                      name: thresholds.0.color
                      value: 0EC9AC
                    - type: STRING
                      name: thresholds.0.threshold
                      value: '0'
                    - type: STRING
                      name: thresholds.1.color
                      value: FF465C
                    - type: STRING
                      name: thresholds.1.threshold
                      value: '1'
                - type: item
                  name: 'Last updated'
                  x: '36'
                  'y': '3'
                  width: '22'
                  height: '3'
                  fields:
                    - type: ITEM
                      name: itemid.0
                      value:
                        host: 'APP-Windows Updates by Zabbix agent active 2'
                        key: Winupdates.LastUpdated
                    - type: INTEGER
                      name: show.0
                      value: '2'
                    - type: INTEGER
                      name: show.1
                      value: '4'
      valuemaps:
        - uuid: 1d72d04f015d492585e6d4fde809e2b9
          name: 'Reboot state'
          mappings:
            - value: '0'
              newvalue: 'False'
            - value: '1'
              newvalue: 'True'
